import numpy as np

# Целевая функция
def fitness_func(x, y):
    return 1 / (1 + x**2 + y**2)

# Метод элиты
def elite_selection(population, fitnesses, elite_fraction):
    sorted_indices = np.argsort(fitnesses)[::-1]
    elites_num = int(len(sorted_indices) * elite_fraction)
    selected_indices = sorted_indices[:elites_num]
    return population[selected_indices]

# Метод рулетки
def roulette_wheel_selection(population, fitnesses):
    probabilities = fitnesses / sum(fitnesses)
    cumulative_probabilities = np.cumsum(probabilities)
    selection = []
    for _ in range(len(population)):
        r = np.random.uniform(0, 1)
        idx = next(i for i, prob in enumerate(cumulative_probabilities) if prob >= r)
        selection.append(idx)
    return population[selection]

# Скрещивание
def crossover(parents):
    offspring = parents.copy()
    crossover_point = np.random.randint(offspring.shape[1])
    parent1 = parents[0]
    parent2 = parents[1]
    offspring[0][crossover_point:] = parent2[crossover_point:]
    offspring[1][:crossover_point] = parent1[:crossover_point]
    return offspring

# Мутация
def mutation(individual, rate=0.1):
    mutated_individual = individual.copy()
    if np.random.rand() < rate:
        index = np.random.randint(len(mutated_individual))
        mutated_individual[index] += np.random.normal(scale=0.1)
    return mutated_individual

# Генетический алгоритм
def genetic_algorithm(population_size, iterations, bounds, method='elite'):
    population = np.random.uniform(bounds[0], bounds[1], (population_size, 2))
    best_fitness = float('-inf')
    best_solution = None
    
    for iteration in range(iterations):
        # Оценка приспособленности
        fitnesses = np.array([fitness_func(x, y) for x, y in population])
        
        # Отбор
        if method == 'elite':
            selected_population = elite_selection(population, fitnesses, 0.1)
        elif method == 'roulette':
            selected_population = roulette_wheel_selection(population, fitnesses)
        
        # Скрещивание
        children = []
        while len(children) < population_size:
            parents = np.random.choice(selected_population, 2, replace=False)
            child_pair = crossover(parents)
            children.extend(child_pair)
        children = np.array(children[:population_size])
        
        # Мутация
        mutated_children = np.array([mutation(child) for child in children])
        
        # Замещение поколения
        population = mutated_children
        
        # Лучший кандидат текущего поколения
        best_candidate = population[np.argmax(fitnesses)]
        current_best_fitness = fitness_func(best_candidate[0], best_candidate[1])
        
        if current_best_fitness > best_fitness:
            best_fitness = current_best_fitness
            best_solution = best_candidate
    
    return best_solution, best_fitness
    bounds = [-5, 5]  # Ограничения значений переменных
population_size = 100
iterations = 100

# Элитарный отбор
best_elite, fitness_elite = genetic_algorithm(population_size, iterations, bounds, method='elite')

# Рулетка
best_roulette, fitness_roulette = genetic_algorithm(population_size, iterations, bounds, method='roulette')

print("Элитный отбор:\nЛучшее решение:", best_elite, "\nФитнес:", fitness_elite)
print("Метод рулетки:\nЛучшее решение:", best_roulette, "\nФитнес:", fitness_roulette)
